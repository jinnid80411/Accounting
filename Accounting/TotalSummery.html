
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <meta name="description" content=""/>
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors"/>
    <meta name="generator" content="Jekyll v4.1.1"/>
    <title>記帳系統</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/4.5/examples/dashboard/"/>


    <!-- Custom styles for this template-->
    

     <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet" />    
    <link href="css/dashboard.css" rel="stylesheet"/>
    <!--other js-->
    <script src="js/Format.js"></script>
    <script src="js/Tools.js"></script>
    
    <script src="js/jquery-3.5.1.min.js"></script>
   <!-- <script src="js/jquery.min.js"></script> -->
   <script src="js/jquery.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/feather.min.js"></script>    
    <link href="bootstrapdatepicker/css/bootstrap-datepicker.css" rel="stylesheet" />
    <script src="bootstrapdatepicker/js/bootstrap-datepicker.js"></script>
    <script src="bootstrapdatepicker/locales/bootstrap-datepicker.zh-TW.min.js"></script>


    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }
    </style>
    <!-- Custom styles for this template -->
</head>

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">
            
            <!-- Main Content -->
            <div id="content">
                <nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
                    <a class="navbar-brand col-md-3 col-lg-2 mr-0 px-3" href="#">記帳系統</a>
                    <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-toggle="collapse" data-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                   
                    <!--
                <ul class="form-control-dark w-100" type="text">
                    <li class="nav-item text-nowrap ">
                        <span style="font-size:18px;color:white;font-weight:bold;position:absolute;">支出品項管理</span>
                    </li>
                </ul>
                -->
                    <!--<span style="font-size:18px;color:white;font-weight:bold;">當日支出</span>-->
                    <!--<input class="form-control form-control-dark w-100" type="text" placeholder="Search" aria-label="Search">-->
                    <ul class="navbar-nav px-3">
                        <li class="nav-item text-nowrap">
                            <a class="nav-link" href="#">Sign in</a>
                        </li>
                    </ul>
            
                </nav>
                
                <p></p>
                <!-- Begin Page Content -->
                <div class="container-fluid">

                    <!-- <div class="input-group">
                        <label class="input-group-text" for="inputGroupSelect01">店家</label>
                        <select name="pets" id="category_List" class="form-control" aria-label="Text input with dropdown button" onchange="List_Expend_Item()"></select>
                    </div>
                    <p></p> -->
                    
                    <!-- Color System -->
                    <h1 class="h3 mb-0 text-gray-800">分店選擇
                    </h1>
                    <p></p>
                    <div class="row" id = "chooseBranch"></div>


                    <p></p>
                    <!-- Page Heading -->
                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                        <h1 class="h3 mb-0 text-gray-800">當月統計</h1>
                        <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i
                                class="fas fa-download fa-sm text-white-50"></i> 下載檔案</a>
                    </div>

                    <!-- Content Row -->
                    <div class="row" id = "BranchInfo">

                        
                    </div>

                    <!-- Content Row -->

                    <div class="row">

                        <!-- Area Chart -->
                        <div class="col-xl-8 col-lg-7">
                            <div class="card shadow mb-4">
                                <!-- Card Header - Dropdown -->
                                <div
                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Earnings Overview</h6>
                                    <div class="dropdown no-arrow">
                                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                                            aria-labelledby="dropdownMenuLink">
                                            <div class="dropdown-header">Dropdown Header:</div>
                                            <a class="dropdown-item" href="#">Action</a>
                                            <a class="dropdown-item" href="#">Another action</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="#">Something else here</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    <div class="chart-area">
                                        <canvas id="myAreaChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pie Chart -->
                        <div class="col-xl-4 col-lg-5">
                            <div class="card shadow mb-4">
                                <!-- Card Header - Dropdown -->
                                <div
                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Revenue Sources</h6>
                                    <div class="dropdown no-arrow">
                                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                                            aria-labelledby="dropdownMenuLink">
                                            <div class="dropdown-header">Dropdown Header:</div>
                                            <a class="dropdown-item" href="#">Action</a>
                                            <a class="dropdown-item" href="#">Another action</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="#">Something else here</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    <div class="chart-pie pt-4 pb-2">
                                        <canvas id="myPieChart"></canvas>
                                    </div>
                                    <div class="mt-4 text-center small">
                                        <span class="mr-2">
                                            <i class="fas fa-circle text-primary"></i> Direct
                                        </span>
                                        <span class="mr-2">
                                            <i class="fas fa-circle text-success"></i> Social
                                        </span>
                                        <span class="mr-2">
                                            <i class="fas fa-circle text-info"></i> Referral
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Content Row -->
                    <div class="row">

                        <!-- Content Column -->
                        <div class="col-lg-6 mb-4">

                            <!-- Project Card Example -->
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Projects</h6>
                                </div>
                                <div class="card-body">
                                    <h4 class="small font-weight-bold">Server Migration <span
                                            class="float-right">20%</span></h4>
                                    <div class="progress mb-4">
                                        <div class="progress-bar bg-danger" role="progressbar" style="width: 20%"
                                            aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <h4 class="small font-weight-bold">Sales Tracking <span
                                            class="float-right">40%</span></h4>
                                    <div class="progress mb-4">
                                        <div class="progress-bar bg-warning" role="progressbar" style="width: 40%"
                                            aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <h4 class="small font-weight-bold">Customer Database <span
                                            class="float-right">60%</span></h4>
                                    <div class="progress mb-4">
                                        <div class="progress-bar" role="progressbar" style="width: 60%"
                                            aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <h4 class="small font-weight-bold">Payout Details <span
                                            class="float-right">80%</span></h4>
                                    <div class="progress mb-4">
                                        <div class="progress-bar bg-info" role="progressbar" style="width: 80%"
                                            aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <h4 class="small font-weight-bold">Account Setup <span
                                            class="float-right">Complete!</span></h4>
                                    <div class="progress">
                                        <div class="progress-bar bg-success" role="progressbar" style="width: 100%"
                                            aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>


                        </div>

                        <div class="col-lg-6 mb-4">

                            <!-- Illustrations -->
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Illustrations</h6>
                                </div>
                                <div class="card-body">
                                    <div class="text-center">
                                        <!-- <img class="img-fluid px-3 px-sm-4 mt-3 mb-4" style="width: 25rem;"
                                            src="img/undraw_posting_photo.svg" alt=""> -->
                                    </div>
                                    <p>Add some quality, svg illustrations to your project courtesy of <a
                                            target="_blank" rel="nofollow" href="https://undraw.co/">unDraw</a>, a
                                        constantly updated collection of beautiful svg images that you can use
                                        completely free and without attribution!</p>
                                    <a target="_blank" rel="nofollow" href="https://undraw.co/">Browse Illustrations on
                                        unDraw &rarr;</a>
                                </div>
                            </div>

                            <!-- Approach -->
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Development Approach</h6>
                                </div>
                                <div class="card-body">
                                    <p>SB Admin 2 makes extensive use of Bootstrap 4 utility classes in order to reduce
                                        CSS bloat and poor page performance. Custom CSS classes are used to create
                                        custom components and custom utility classes.</p>
                                    <p class="mb-0">Before working with this theme, you should become familiar with the
                                        Bootstrap framework, especially the utility classes.</p>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>
                <!-- /.container-fluid -->

            </div>
            <!-- End of Main Content -->

            <!-- Footer -->
            <footer class="sticky-footer bg-white">
                <div class="container my-auto">
                    <div class="copyright text-center my-auto">
                        <span>Copyright &copy; Your Website 2020</span>
                    </div>
                </div>
            </footer>
            <!-- End of Footer -->

        </div>
        <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

    <!-- Logout Modal-->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                    <a class="btn btn-primary" href="login.html">Logout</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap core JavaScript
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>-->

    <!-- Core plugin JavaScript-->
    <!-- <script src="vendor/jquery-easing/jquery.easing.min.js"></script> -->

    <!-- Custom scripts for all pages-->
    <!-- <script src="js/sb-admin-2.min.js"></script> -->

    <!-- Page level plugins -->
    <script src="vendor/chart.js/Chart.min.js"></script>

    <!-- Page level custom scripts -->
    <script src="js/chart-area-demo.js"></script>
    <script src="js/chart-pie-demo.js"></script>

</body>

<script>
    /*const words = [{A:'spray', B:'limit'}, {A:'spray', B:'exuberant'}, {A:'destruction', B:'present'}];

const result = words.filter(word => word.A == 'spray');

console.log(result);
// expected output: Array ["exuberant", "destruction", "present"]
*/
    var company_data=[{cs_name:"山子頂",cs_code:"AAA"},{cs_name:"中正店",cs_code:"BBB"}];
    //選擇分店
    var item_value = [{ cs_name: "山子頂",cs_code:"AAA", InCome: "10000", OutCome: "5000", date: "2020-01-01" }
    , { cs_name: "山子頂",cs_code:"AAA", InCome: "2000", OutCome: "300", date: "2020-01-02" }
    , { cs_name: "山子頂",cs_code:"AAA", InCome: "3000", OutCome: "100", date: "2020-02-03" }
    , { cs_name: "中正店",cs_code:"BBB", InCome: "3000", OutCome: "100", date: "2020-01-01" }
    , { cs_name: "中正店",cs_code:"BBB", InCome: "3000", OutCome: "100", date: "2020-04-01" }
    , { cs_name: "中正店",cs_code:"BBB", InCome: "5000", OutCome: "100", date: "2020-04-03" }];

    // var cs_list = new Array();
    var month_OutCome = new Array();
    var month_Income = new Array();
    var tot_OutCome=0,tot_Income=0;
    console.log(item_value.length);

    //分店資訊
    var count_cs=0;//分店數
    GetBranchName();

    //資料處理
    Mouth_total();

    
    //顯示分店訊息
    function GetBranchName()
    {
        
        var chooseBranch = document.getElementById('chooseBranch');
        var items = "";
        
        $.each(company_data, function (index, item) 
        {
            items += '<div class="col-lg-3 mb-4" >';
            items += '<div type = \"button\" id =\"Branch' + item.cs_name + '\" class=\"card text-white shadow\" style=\"background-color: cadetblue\" onclick = \" chooseBranch(\'' + item.cs_name+'\');\">';
            items += '<div class="card-body">' + item.cs_name;
            // items += '<div class="text-white-50 small"></div>';
            items += '</div>';
            items += '</div>';
            items += '</div>';
        //     console.log(item);
           

        });
        chooseBranch.innerHTML = items;
        //
    }

    //parse 每間店月份資訊
    function Mouth_total()
    {  
        
        
        //給陣列空間[月份][分店數]
        for(var j = 0; j < 13; j++)
        { 
            month_OutCome[j] = new Array();
            month_Income[j] = new Array();
            for(var i=0;i<company_data.length;i++)
            {
                month_OutCome[j][i] = 0;
                month_Income[j][i] = 0;
            }
        }

        //計算金額
        for (var i = 0; i < item_value.length; i++)
        {
            
            var vals = item_value[i].date.split('-');
            var year = vals[0];
            var month = vals[1];
            var day = vals[2];
            // console.log(day, month, year);
            var cs_list_count=0;

            for(var j=0;j<company_data.length;j++)
            {           
                if(company_data[j].cs_code == item_value[i].cs_code)
                {
                    cs_list_count = j;
                    break;
                }

            }
            console.log(cs_list_count);
            month_OutCome[parseInt(month)][cs_list_count] += parseInt(item_value[i].OutCome);
            month_Income[parseInt(month)][cs_list_count] += parseInt(item_value[i].InCome);
            

        }
        console.log(month_OutCome);
        console.log(month_Income);


        
    }
    

    function chooseBranch(BranchName)
    {
        var dt = new Date();
        GetBranchName();
        var BranchID = 'Branch'+BranchName;
        // console.log(BranchID);
        // console.log(BranchName);
        var chooseBranch = document.getElementById(BranchID);

        chooseBranch.style.backgroundColor = "darkgoldenrod";
        var BranchInfo = document.getElementById('BranchInfo');
        var SummeryItem = [ "總收入", "總支出" ];
        var items = "";
        for(var i=0;i<company_data.length;i++)
        {
            
            if(company_data[i].cs_name == BranchName)
            {
                console.log("月份"+dt.getMonth()+1);
                console.log("店名:"+company_data[i].cs_name+"編號:"+i);  
                for(var j=0; j<SummeryItem.length; j++)
                {
                    if(j==0) amt = month_OutCome[dt.getMonth()+1][i];
                    if(j==1) amt = month_Income[dt.getMonth()+1][i];
                    items += '<div class="col-xl-3 col-md-6 mb-4">';
                    items += '<div class="card border-left-primary shadow h-100 py-2">';
                    items += '<div class="card-body">';
                    items += '<div class="row no-gutters align-items-center">';
                    items += '<div class="col mr-2">';
                    items += '<div class="text-xs font-weight-bold text-primary text-uppercase mb-1">';
                    items += SummeryItem[j]+'</div>';
                    items += '<div class="h5 mb-0 font-weight-bold text-gray-800">$'+amt+'</div>';
                    items += '</div>';
                    items += '<div class="col-auto">';
                    items += '<i class="fas fa-calendar fa-2x text-gray-300"</i>';
                    items += '</div>';
                    items += '</div>';
                    items += '</div>';
                    items += '</div>';
                    items += '</div>';
                    console.log(SummeryItem[j]);
                }
                LineChart(i);
            }
        }
        BranchInfo.innerHTML = items;
        
        

    }
    function random_bg_color() 
        {
        var x = Math.floor(Math.random() * 256);
        var y = Math.floor(Math.random() * 256);
        var z = Math.floor(Math.random() * 256);
        var bgColor = "rgb(" + x + "," + y + "," + z + ")";
        // console.log(bgColor);
        return bgColor;
        // document.body.style.background = bgColor;
    }




    // Set new default font family and font color to mimic Bootstrap's default styling
    Chart.defaults.global.defaultFontFamily = 'Nunito', '-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif';
    Chart.defaults.global.defaultFontColor = '#858796';
    function number_format(number, decimals, dec_point, thousands_sep) 
    {
        // *     example: number_format(1234.56, 2, ',', ' ');
        // *     return: '1 234,56'
        number = (number + '').replace(',', '').replace(' ', '');
        var n = !isFinite(+number) ? 0 : +number,
            prec = !isFinite(+decimals) ? 0 : Math.abs(decimals),
            sep = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep,
            dec = (typeof dec_point === 'undefined') ? '.' : dec_point,
            s = '',
            toFixedFix = function(n, prec) {
            var k = Math.pow(10, prec);
            return '' + Math.round(n * k) / k;
            };
        // Fix for IE parseFloat(0.55).toFixed(0) = 0;
        s = (prec ? toFixedFix(n, prec) : '' + Math.round(n)).split('.');
        if (s[0].length > 3) {
            s[0] = s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g, sep);
        }
        if ((s[1] || '').length < prec) {
            s[1] = s[1] || '';
            s[1] += new Array(prec - s[1].length + 1).join('0');
        }
        return s.join(dec);
    }
    function LineChart(cs_count)
    {

        // Area Chart Example
        var ctx = document.getElementById("myAreaChart");
        var myLineChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
            datasets: [{
            label: "Earnings",
            lineTension: 0.3,
            backgroundColor: "rgba(78, 115, 223, 0.05)",
            borderColor: "rgba(78, 115, 223, 1)",
            pointRadius: 3,
            pointBackgroundColor: "rgba(78, 115, 223, 1)",
            pointBorderColor: "rgba(78, 115, 223, 1)",
            pointHoverRadius: 3,
            pointHoverBackgroundColor: "rgba(78, 115, 223, 1)",
            pointHoverBorderColor: "rgba(78, 115, 223, 1)",
            pointHitRadius: 10,
            pointBorderWidth: 2,
            data: [month_OutCome[1][cs_count], month_OutCome[2][cs_count], month_OutCome[3][cs_count], month_OutCome[4][cs_count], month_OutCome[5][cs_count], month_OutCome[6][cs_count], month_OutCome[7][cs_count], month_OutCome[8][cs_count], month_OutCome[9][cs_count], month_OutCome[10][cs_count], month_OutCome[11][cs_count], month_OutCome[12][cs_count]],
            }],
        },
        options: 
        {
            maintainAspectRatio: false,
            layout: 
            {
                padding: 
                {
                    left: 10,
                    right: 25,
                    top: 25,
                    bottom: 0
                }
            },
            scales: 
            {
            xAxes: [
                {
                time: 
                {
                    unit: 'date'
                },
                gridLines: 
                {
                    display: false,
                    drawBorder: false
                },
                ticks: 
                {
                    maxTicksLimit: 7
                }
            }],
            yAxes: [{
                ticks: 
                {
                    maxTicksLimit: 5,
                    padding: 10,
                    // Include a dollar sign in the ticks
                    // callback: function(value, index, values) 
                    // {
                    //     return '$' + number_format(value);
                    // }
                },
                gridLines: {
                color: "rgb(234, 236, 244)",
                zeroLineColor: "rgb(234, 236, 244)",
                drawBorder: false,
                borderDash: [2],
                zeroLineBorderDash: [2]
                }
            }],
        },
        legend: 
        {
            display: false
        },
        // tooltips: 
        // {
        //     backgroundColor: "rgb(255,255,255)",
        //     bodyFontColor: "#858796",
        //     titleMarginBottom: 10,
        //     titleFontColor: '#6e707e',
        //     titleFontSize: 14,
        //     borderColor: '#dddfeb',
        //     borderWidth: 1,
        //     xPadding: 15,
        //     yPadding: 15,
        //     displayColors: false,
        //     intersect: false,
        //     mode: 'index',
        //     caretPadding: 10,
        //     callbacks: 
        //     {
        //         label: function(tooltipItem, chart) 
        //         {
        //             var datasetLabel = chart.datasets[tooltipItem.datasetIndex].label || '';
        //             return datasetLabel + ': $' + number_format(tooltipItem.yLabel);
        //         }
        //     }
        // }
        }
        });
    }
    
    
</script>


	

</html>


